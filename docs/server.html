

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Server &mdash; Luxure</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="/luxure/server.html" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sse" href="sse.html" />
    <link rel="prev" title="Router" href="router.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="error.html">Error</a></li>
<li class="toctree-l1"><a class="reference internal" href="router.html">Router</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#registering-handlers">Registering Handlers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sse.html">Sse</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/server.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="server">
<h1>Server<a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h1>
<dl class="lua class">
<dt id="Opts">
<em class="property">class </em><code class="sig-name descname">Opts</code><a class="headerlink" href="#Opts" title="Permalink to this definition">¶</a></dt>
<dd><p>The options a server knows about</p>
<dl class="lua attribute">
<dt id="Opts.env">
<code class="sig-name descname">env</code><em class="property">: </em>str<a class="headerlink" href="#Opts.env" title="Permalink to this definition">¶</a></dt>
<dd><p>‘debug’|’production’ if debug, more information is provided on errors</p>
</dd></dl>

<dl class="lua attribute">
<dt id="Opts.backlog">
<code class="sig-name descname">backlog</code><em class="property">: </em>number<a class="headerlink" href="#Opts.backlog" title="Permalink to this definition">¶</a></dt>
<dd><p>The number to pass to <cite>socket:listen</cite></p>
</dd></dl>

<dl class="lua staticmethod">
<dt id="Opts.new">
<em class="property">static </em><code class="sig-name descname">new</code><span class="sig-paren">(</span><em class="sig-param">t</em><span class="sig-paren">)</span><a class="headerlink" href="#Opts.new" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new options object</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>t</strong> (<em>table or nil</em>) – If not the pre-set options</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#Opts" title="Opts">Opts</a></p>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Opts.set_backlog">
<em class="property"> </em><code class="sig-name descname">set_backlog</code><span class="sig-paren">(</span><em class="sig-param">backlog</em><span class="sig-paren">)</span><a class="headerlink" href="#Opts.set_backlog" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the backlog property</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>backlog</strong> (<em>number</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#Opts" title="Opts">Opts</a></p>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Opts.set_env">
<em class="property"> </em><code class="sig-name descname">set_env</code><span class="sig-paren">(</span><em class="sig-param">env</em><span class="sig-paren">)</span><a class="headerlink" href="#Opts.set_env" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the env property</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>env</strong> (<em>str</em>) – ‘production’|’debug’ The env string</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#Opts" title="Opts">Opts</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="lua class">
<dt id="Server">
<em class="property">class </em><code class="sig-name descname">Server</code><a class="headerlink" href="#Server" title="Permalink to this definition">¶</a></dt>
<dd><p>The primary interface for working with this framework
it can be used to register middleware and route handlers</p>
<dl class="lua attribute">
<dt id="Server.sock">
<code class="sig-name descname">sock</code><em class="property">: </em>table<a class="headerlink" href="#Server.sock" title="Permalink to this definition">¶</a></dt>
<dd><p>socket being used by the server</p>
</dd></dl>

<dl class="lua attribute">
<dt id="Server.router">
<code class="sig-name descname">router</code><em class="property">: </em>Router<a class="headerlink" href="#Server.router" title="Permalink to this definition">¶</a></dt>
<dd><p>The router for incoming requests</p>
</dd></dl>

<dl class="lua attribute">
<dt id="Server.middleware">
<code class="sig-name descname">middleware</code><em class="property">: </em>table<a class="headerlink" href="#Server.middleware" title="Permalink to this definition">¶</a></dt>
<dd><p>List of middleware callbacks</p>
</dd></dl>

<dl class="lua attribute">
<dt id="Server.ip">
<code class="sig-name descname">ip</code><em class="property">: </em>str<a class="headerlink" href="#Server.ip" title="Permalink to this definition">¶</a></dt>
<dd><p>defaults to ‘0.0.0.0’</p>
</dd></dl>

<dl class="lua attribute">
<dt id="Server.env">
<code class="sig-name descname">env</code><em class="property">: </em>str<a class="headerlink" href="#Server.env" title="Permalink to this definition">¶</a></dt>
<dd><p>defaults to ‘production’</p>
</dd></dl>

<dl class="lua attribute">
<dt id="Server.backlog">
<code class="sig-name descname">backlog</code><em class="property">: </em>number or nil<a class="headerlink" href="#Server.backlog" title="Permalink to this definition">¶</a></dt>
<dd><p>defaults to nil</p>
</dd></dl>

<dl class="lua staticmethod">
<dt id="Server.new">
<em class="property">static </em><code class="sig-name descname">new</code><span class="sig-paren">(</span><em class="sig-param">opts</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.new" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor for a Server that will use luasocket’s socket</p>
<p>implementation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>opts</strong> (<a class="reference internal" href="#Opts" title="Opts"><em>Opts</em></a>) – The configuration of this Server</p>
</dd>
</dl>
</dd></dl>

<dl class="lua staticmethod">
<dt id="Server.new_with">
<em class="property">static </em><code class="sig-name descname">new_with</code><span class="sig-paren">(</span><em class="sig-param">sock</em>, <em class="sig-param">opts</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.new_with" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor for a Server that will use the provided socket</p>
<p>The socket provided must have a similar api to the luasocket’s tcp socket and
also be compatible with cosock</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sock</strong> (<em>table</em>) – The socket to use</p></li>
<li><p><strong>opts</strong> (<a class="reference internal" href="#Opts" title="Opts"><em>Opts</em></a>) – The configuration of this Server</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server.set_ip">
<em class="property"> </em><code class="sig-name descname">set_ip</code><span class="sig-paren">(</span><em class="sig-param">ip</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.set_ip" title="Permalink to this definition">¶</a></dt>
<dd><p>Override the default IP address</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ip</strong> (<em>str</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#Server" title="Server">Server</a></p>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server.listen">
<em class="property"> </em><code class="sig-name descname">listen</code><span class="sig-paren">(</span><em class="sig-param">port</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.listen" title="Permalink to this definition">¶</a></dt>
<dd><p>Attempt to open a socket</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>port</strong> (<em>number or nil</em>) – If provided, the port this server will attempt to bind on</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#Server" title="Server">Server</a></p>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server.use">
<em class="property"> </em><code class="sig-name descname">use</code><span class="sig-paren">(</span><em class="sig-param">middleware</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.use" title="Permalink to this definition">¶</a></dt>
<dd><p>Register some middleware to be use for each request</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>middleware</strong> (<em>fun(Request, Response, fun(Request, Response))</em>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#Server" title="Server">Server</a></p>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server.route">
<em class="property"> </em><code class="sig-name descname">route</code><span class="sig-paren">(</span><em class="sig-param">req</em>, <em class="sig-param">res</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.route" title="Permalink to this definition">¶</a></dt>
<dd><p>Route a request, first through any registered middleware</p>
<p>followed by any registered handler</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>req</strong> (<em>Request</em>) – </p></li>
<li><p><strong>res</strong> (<em>Response</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server._tick">
<em class="property"> </em><code class="sig-name descname">_tick</code><span class="sig-paren">(</span><em class="sig-param">incoming</em><span class="sig-paren">)</span><a class="headerlink" href="#Server._tick" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>incoming</strong> (<em>any</em>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server.tick">
<em class="property"> </em><code class="sig-name descname">tick</code><span class="sig-paren">(</span><em class="sig-param">err_callback</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.tick" title="Permalink to this definition">¶</a></dt>
<dd><p>A single step in the Server run loop</p>
<p>which will call <cite>accept</cite> on the underlying socket and when that returns a client socket, it will attempt to route the Request/Response objects through the registered middleware and routes</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>err_callback</strong> (<em>any</em>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server._run">
<em class="property"> </em><code class="sig-name descname">_run</code><span class="sig-paren">(</span><em class="sig-param">err_callback</em>, <em class="sig-param">should_continue</em><span class="sig-paren">)</span><a class="headerlink" href="#Server._run" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>err_callback</strong> (<em>any</em>) – </p></li>
<li><p><strong>should_continue</strong> (<em>any</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="lua method">
<dt id="Server.run">
<em class="property"> </em><code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param">err_callback</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Start this server, blocking forever</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>err_callback</strong> (<em>fun(str):boolean</em>) – Optional callback to be run if <cite>tick</cite> returns an error</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="section" id="registering-handlers">
<h2>Registering Handlers<a class="headerlink" href="#registering-handlers" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Server</span></code> table also provides a method for registering a handler for each of the HTTP
methods. The name for each of these methods is formatted into lower snake case and they all take
the path as the first argument and a function as the second argument and all return the server instance.
The function argument will take 2 arguments, the Request first and the Response second.
For example registering a <code class="docutils literal notranslate"><span class="pre">GET</span></code> and <code class="docutils literal notranslate"><span class="pre">POST</span></code> request handler for the <cite>/</cite> path you would use the following method calls.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">server</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
  <span class="n">res</span><span class="p">:</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
<span class="p">:</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
  <span class="n">res</span><span class="p">:</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<p>The following methods are available.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">acl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bind</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkout</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connect</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">copy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">head</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">link</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lock</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m_search</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">merge</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mkactivity</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mkcalendar</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mkcol</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">move</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">notify</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">patch</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">post</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">propfind</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proppatch</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">purge</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">put</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rebind</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">report</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subscribe</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trace</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unbind</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unlink</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unlock</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unsubscribe</span></code></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sse.html" class="btn btn-neutral float-right" title="Sse" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="router.html" class="btn btn-neutral float-left" title="Router" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>